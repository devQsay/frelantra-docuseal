version: 0.2

env:
  variables:
    ECR_REGISTRY: 820976529764.dkr.ecr.us-east-1.amazonaws.com
    ECR_REPOSITORY: docuseal-frelantra

phases:
  install:
    runtime-versions:
      docker: 19
    commands:
      - echo Logging in to Amazon ECR…
      - aws --version
      - aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin $ECR_REGISTRY

  build:
    commands:
      - echo Build started on `date`
      - echo Building the Docker image for linux/amd64…
      - docker buildx create --name multiarch-builder --driver docker-container --use
      - docker buildx inspect --bootstrap
      - docker buildx build \
        --platform linux/amd64 \
        -t $ECR_REGISTRY/$ECR_REPOSITORY:latest \
        --push \
        .

artifacts:
  files:
    - "**/*"
